<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Richiesta Prenotazione | Booking Request</title>

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<style>
body {font-family: Arial, sans-serif; margin:10px; background:#f5f7fb;}
h2 {text-align:center; font-size:20px;}
#calendar {max-width:900px; margin:20px auto;}

#bookingForm {
  max-width:900px; margin:20px auto; background:white;
  padding:20px; border-radius:12px;
  box-shadow:0 10px 30px rgba(0,0,0,0.15);
  display:none; position:relative;
  animation: fadeSlide 0.4s ease;
}

@keyframes fadeSlide {
  from {opacity:0; transform:translateY(20px);}
  to {opacity:1; transform:translateY(0);}
}

.closeBtn {
  position:absolute; top:10px; right:15px;
  font-size:20px; cursor:pointer; color:#888;
}

input, select {width:100%; padding:10px; margin-top:5px; margin-bottom:12px; border-radius:8px; border:1px solid #ccc;}

label {font-weight:bold;}

.row {display:flex; align-items:center; gap:10px;}

.circle-btn {
  width:35px; height:35px; border-radius:50%;
  border:none; background:#1e88e5; color:white;
  font-size:18px; cursor:pointer;
}

.counter {
  font-size:18px; font-weight:bold; min-width:30px; text-align:center;
}

button.submitBtn {
  background:#1e88e5; color:white; border:none;
  padding:14px; width:100%; font-size:16px;
  border-radius:10px; cursor:pointer;
}

.summary {background:#e3f2fd; padding:12px; border-radius:10px; margin-bottom:15px;}

@media (max-width:600px){
  h2{font-size:18px;}
}
</style>
</head>

<body>

<h2>Dettagli richiesta di prenotazione | Booking Request Details</h2>
<div id="calendar"></div>

<div id="bookingForm">
  <div class="closeBtn" onclick="closeForm()">✖</div>
  <div class="summary" id="summaryBox"></div>

  <label>Camere | Rooms (max 3)*</label>
  <div class="row">
    <button class="circle-btn" type="button" onclick="changeRooms(-1)">−</button>
    <div class="counter" id="rooms">1</div>
    <button class="circle-btn" type="button" onclick="changeRooms(1)">+</button>
  </div>

  <label>Ospiti | Guests (max 2 per camera)*</label>
  <div class="row">
    <button class="circle-btn" type="button" onclick="changeGuests(-1)">−</button>
    <div class="counter" id="guests">2</div>
    <button class="circle-btn" type="button" onclick="changeGuests(1)">+</button>
  </div>

  <label>Nome *</label>
  <input type="text" id="firstName" required>

  <label>Cognome *</label>
  <input type="text" id="lastName" required>

  <label>Telefono *</label>
  <div class="row">
    <select id="prefix" required></select>
    <input type="tel" id="phone" required>
  </div>

  <label>Email *</label>
  <input type="email" id="email" required>

  <label>Conferma Email *</label>
  <input type="email" id="confirmEmail" required>

  <label>Paese | Country *</label>
  <select id="country" required></select>

  <button class="submitBtn" onclick="sendBooking()">Invia Richiesta</button>
</div>

<script>
emailjs.init("lTdk4iSo1q1QytRhq");

let checkin=null, checkout=null, defaultPrice=100;

const today = new Date(); today.setHours(0,0,0,0);
const maxDate = new Date(); maxDate.setMonth(maxDate.getMonth()+7);

const calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
  initialView:'dayGridMonth',
  locale:'it',
  selectable:true,
  validRange:{ start: today, end: maxDate },
  dateClick(info){
    let clicked=new Date(info.dateStr);
    if(!checkin || checkout){
      checkin=clicked; checkout=null; clearSel(); mark(clicked);
    } else {
      if(clicked<=checkin){checkin=clicked; clearSel(); mark(clicked); return;}
      checkout=clicked; markRange(checkin,checkout); showForm();
    }
  }
});
calendar.render();

function mark(d){document.querySelector(`[data-date='${d.toISOString().split('T')[0]}']`).style.background="#a5d6ff";}
function markRange(s,e){let c=new Date(s);while(c<=e){mark(c);c.setDate(c.getDate()+1);}}
function clearSel(){document.querySelectorAll("[data-date]").forEach(el=>el.style.background="");}

function showForm(){document.getElementById("bookingForm").style.display="block"; updateSummary();}
function closeForm(){document.getElementById("bookingForm").style.display="none"; clearSel(); checkin=null; checkout=null;}

function updateSummary(){
  let nights=(checkout-checkin)/(1000*60*60*24);
  let total=nights*defaultPrice*parseInt(rooms.innerText);
  summaryBox.innerHTML=`<b>Check-in:</b> ${checkin.toLocaleDateString()}<br>
                        <b>Check-out:</b> ${checkout.toLocaleDateString()}<br>
                        <b>Notti:</b> ${nights}<br>
                        <b>Totale soggiorno:</b> €${total}`;
}

function changeRooms(v){
  let r=parseInt(rooms.innerText)+v;
  if(r<1)r=1;if(r>3)r=3;rooms.innerText=r;changeGuests(0);updateSummary();
}
function changeGuests(v){
  let max=parseInt(rooms.innerText)*2;
  let g=parseInt(guests.innerText)+v;
  if(g<1)g=1;if(g>max)g=max;guests.innerText=g;
}

function sendBooking(){
  if(email.value!==confirmEmail.value){alert("Email non coincidono");return;}
  let params={
    firstName:firstName.value,
    lastName:lastName.value,
    checkin:checkin.toLocaleDateString(),
    checkout:checkout.toLocaleDateString(),
    guests:guests.innerText,
    rooms:rooms.innerText,
    phone:prefix.value+" "+phone.value,
    email:email.value,
    country:country.value
  };
  emailjs.send("service_IlFicobnb","template_pr1fttu",params)
  .then(()=>{alert("Richiesta inviata!");location.reload();},
        ()=>alert("Errore invio"));
}

const prefixes=["+39 Italia","+44 UK","+1 USA","+33 Francia","+49 Germania","+34 Spagna","+41 Svizzera","+43 Austria","+31 Olanda","+32 Belgio"];
prefixes.forEach(p=>prefix.add(new Option(p,p)));

const countries=["Italia","Germany","France","USA","UK","Spain","Switzerland","Austria","Netherlands","Belgium"];
countries.forEach(c=>country.add(new Option(c,c)));
</script>
</body>
</html>
